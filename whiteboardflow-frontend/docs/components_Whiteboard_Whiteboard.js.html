<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: components/Whiteboard/Whiteboard.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: components/Whiteboard/Whiteboard.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// React.js Imports
import React, { useEffect, useRef, useState } from 'react';
import { useNavigate } from 'react-router-dom';

// Material-UI Imports for UI components
import { Box } from '@mui/material';

// Import components
import QuestionArea from './QuestionArea';
import SubmitButton from './SubmitButton';
import HelpModal from './HelpModal';
import CustomMenuAction from './CustomMenuAction';
import { auth } from "../../firebase";
import { getStorage, ref, uploadBytes, getDownloadURL } from "firebase/storage";

// Style imports
import './css/reset.css';
import './css/components.css';
import './css/examples.css';
import './css/custom-menu-action.css';

/**
 * ${1:Description placeholder}
 *
 * @returns {${2:*}}
 */
const Whiteboard = () => {
    // Refs for DOM elements and editor instance
    const editor = useRef(null)
    const editorElement = useRef(null)
    const navigate = useNavigate();
    const [isQuestionVisible, setQuestionVisible] = useState(true); // State to toggle question visibility
    const [modalVisible, setModalVisible] = useState(false);

    const toggleModal = () => setModalVisible(!modalVisible);
    // Effect for editor initialization and event handling
    useEffect(() => {
        // Function to handle window resizing to adjust editor dimensions
        const handleResize = () => {
            if (editor.current) {
                editor.current.resize();
            }
        };

        // Function to load editor configuration and initialize it
        const loadEditor = async () => {
            try {
                const response = await fetch("server-configuration.json");
                const server = await response.json();
                const options = {
                    configuration: {
                        offscreen: true,
                        server,
                        rendering: {
                            minWidth: 1240,
                            minHeight: 2000,
                            guides: {
                                enable: true,
                                gap: 50,
                                type: 'line'
                            }
                        },
                        recognition: {
                            alwaysConnected: false,
                        },
                        modules: {
                            eraser: true,
                            transcript: true
                        },
                        triggers: {
                            exportContent: "ONDEMAND"
                        },
                        menu: {
                            style: {
                                enable: false
                            },
                            intention: {
                                enable: false
                            },
                            action: {
                                enable: true
                            }
                        }

                    },
                    behaviors: {
                        menu: {
                            action: CustomMenuAction
                        }
                    }
                };
                editor.current = new window.iink.Editor(editorElement.current, options);
                await editor.current.initialize();
                deleteElements();
                if (!editor.current) {
                    console.error("Editor is not initialized.");
                }
                window.addEventListener("resize", handleResize);
            } catch (error) {
                console.error("Error during iink Editor initialization:", error);
            }
        };

        loadEditor();

        // Cleanup function to remove the resize event listener
        return () => {
            window.removeEventListener("resize", handleResize);
        };
    }, []);

    // Function to handle export and submission of editor content
    const handleExportAndSubmit = async () => {
        try {
            if (editor.current) {
                await sendPNGToFirebase(editor.current.behaviors.haveSymbolsSelected);
                navigate('/oraltest'); // Navigate to the OralTest page after export
            }
        } catch (error) {
            console.error('Error during export or send:', error);
        }
    };

    // Handle resizing stop event
    const handleResizeStop = (e, direction, ref) => {
        const width = parseInt(ref.style.width, 10);
        setQuestionVisible(width > 15);  // Toggle visibility based on the width threshold
    };
    // Hide unnecessary elements
    function deleteElements() {
        // var menu = document.querySelector('.ms-menu.ms-menu-top-left.ms-menu-row');
        // if (menu &amp;&amp; menu.children.length > 1) {
        //     // Remove the second child
        //     menu.removeChild(menu.children[1]);
        // }
        // // Check if the main menu element exists
        // if (menu) {
        //     // Find the first child with the class 'sub-menu-content.buttom.open' within the first child of the main menu
        //     var subMenuContent = menu.children[0]?.querySelector('.sub-menu-content.buttom.open');
        //
        //     // Check if the sub-menu content element exists
        //     if (subMenuContent) {
        //         // Find the element with the class 'ms-menu-column' within the sub-menu content
        //         var menuColumn = subMenuContent.querySelector('.ms-menu-column');
        //
        //         // Check if the menu column element exists and has at least four children
        //         if (menuColumn &amp;&amp; menuColumn.children.length >= 4) {
        //             // Remove the first four children
        //             for (let i = 0; i &lt; 4; i++) {
        //                 menuColumn.removeChild(menuColumn.children[0]);
        //             }
        //         }
        //     }
        // }
        // document.querySelector('.ms-menu.ms-menu-top-right').style.display = 'none';
        // document.querySelector('.ms-menu.ms-menu-bottom.ms-menu-row').style.display = 'none';
        // Select the first child div of the element with class 'state'
        const stateElement = document.querySelector('.state'); // Select the element with class 'state'
        if (stateElement) {
            stateElement.remove();
        }
    }

    const sendPNGToFirebase = async (i = false) => {
        return new Promise((resolve, reject) => {
            const behaviors = editor.current.behaviors;
            const symbols = i ? behaviors.model.symbolsSelected : behaviors.model.symbols;
            const bounds = behaviors.getSymbolsBounds(symbols);
            const svgBlob = behaviors.buildBlobFromSymbols(symbols, bounds);
            const svgUrl = URL.createObjectURL(svgBlob);
            const img = new Image();

            img.onload = async () => {
                const canvas = document.createElement('canvas');
                canvas.width = img.width;
                canvas.height = img.height;
                const ctx = canvas.getContext('2d');
                ctx.fillStyle = '#FFFFFF'; // Set the background color to white
                ctx.fillRect(0, 0, canvas.width, canvas.height); // Fill canvas
                ctx.drawImage(img, 0, 0);
                URL.revokeObjectURL(svgUrl); // Clean up the SVG blob URL

                // Convert the canvas to PNG
                canvas.toBlob(async (pngBlob) => {
                    const userId = auth.currentUser.uid;
                    const storage = getStorage();
                    const storageRef = ref(storage, `user-files/${userId}/static.png`);

                    try {
                        const snapshot = await uploadBytes(storageRef, pngBlob);
                        console.log("Image uploaded to Firebase successfully.");

                        const downloadURL = await getDownloadURL(snapshot.ref);
                        resolve(downloadURL); // Resolve with the download URL
                    } catch (error) {
                        console.error("Error uploading image to Firebase:", error);
                        reject(error); // Reject in case of an error
                    }
                }, 'image/png');
            };
            img.onerror = (error) => {
                reject(error); // Reject if thereâ€™s an image load error
            };
            img.src = svgUrl;
        });
    };

    return (
        &lt;div style={{ width: '100%', height: '100vh', display: 'flex', position: 'fixed', overflow: 'hidden' }}>

            {/* Question Area */}
            &lt;QuestionArea isVisible={isQuestionVisible} onResizeStop={handleResizeStop} sendPNGToFirebase={sendPNGToFirebase} />

            {/* Editor Section */}
            &lt;div style={{
                display: 'flex',
                flexDirection: 'column',
                flexGrow: 1,
                height: '100vh'
            }}>
                &lt;div
                    ref={editorElement}
                    style={{
                        flexGrow: 1,
                        height: '93vh',
                        touchAction: 'none',
                        borderRadius: '8px',
                        border: '1px solid #ddd',
                        padding: '10px',
                        boxShadow: '0px 4px 12px rgba(0, 0, 0, 0.1)',
                        backgroundColor: '#fff',
                    }}
                />
                &lt;a id="link-info" className="link-info" onClick={toggleModal} style={{ cursor: 'pointer', zIndex: '1000' }}>
                    &lt;img src="/img/info.svg" alt="Info" />
                &lt;/a>
                &lt;HelpModal isVisible={modalVisible} onClose={() => setModalVisible(false)} />
                {/* Submit Area */}
                &lt;Box sx={{
                    height: '7vh',
                    width: '100%',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    borderTop: '1px solid #ccc'
                }}>
                    &lt;SubmitButton onExport={handleExportAndSubmit} />
                &lt;/Box>
            &lt;/div>
        &lt;/div>
    );
};

export default Whiteboard;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="module.exports_module.exports.html">exports</a></li></ul><h3>Global</h3><ul><li><a href="global.html#AIAssistant">AIAssistant</a></li><li><a href="global.html#AccountSettings">AccountSettings</a></li><li><a href="global.html#AvatarContext">AvatarContext</a></li><li><a href="global.html#AvatarProvider">AvatarProvider</a></li><li><a href="global.html#AvatarToggleButton">AvatarToggleButton</a></li><li><a href="global.html#BackEndTest">BackEndTest</a></li><li><a href="global.html#Backdrop">Backdrop</a></li><li><a href="global.html#Character">Character</a></li><li><a href="global.html#Footer">Footer</a></li><li><a href="global.html#HelpButton">HelpButton</a></li><li><a href="global.html#HelpModal">HelpModal</a></li><li><a href="global.html#Helper">Helper</a></li><li><a href="global.html#HintButton">HintButton</a></li><li><a href="global.html#HomePage">HomePage</a></li><li><a href="global.html#Layout">Layout</a></li><li><a href="global.html#Login">Login</a></li><li><a href="global.html#Main">Main</a></li><li><a href="global.html#Menu">Menu</a></li><li><a href="global.html#MicPrompt">MicPrompt</a></li><li><a href="global.html#Modal">Modal</a></li><li><a href="global.html#ModalContent">ModalContent</a></li><li><a href="global.html#Profile">Profile</a></li><li><a href="global.html#QuestionArea">QuestionArea</a></li><li><a href="global.html#RedirectToImage">RedirectToImage</a></li><li><a href="global.html#Results">Results</a></li><li><a href="global.html#RetroAvatar">RetroAvatar</a></li><li><a href="global.html#SpeechRecognition">SpeechRecognition</a></li><li><a href="global.html#StyledBackdrop">StyledBackdrop</a></li><li><a href="global.html#SubmitButton">SubmitButton</a></li><li><a href="global.html#Whiteboard">Whiteboard</a></li><li><a href="global.html#app">app</a></li><li><a href="global.html#auth">auth</a></li><li><a href="global.html#blue">blue</a></li><li><a href="global.html#firebaseConfig">firebaseConfig</a></li><li><a href="global.html#frames">frames</a></li><li><a href="global.html#getIdToken">getIdToken</a></li><li><a href="global.html#grey">grey</a></li><li><a href="global.html#provider">provider</a></li><li><a href="global.html#recognition">recognition</a></li><li><a href="global.html#render">render</a></li><li><a href="global.html#reportWebVitals">reportWebVitals</a></li><li><a href="global.html#root">root</a></li><li><a href="global.html#toggleMenu">toggleMenu</a></li><li><a href="global.html#useAvatar">useAvatar</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Sun Nov 10 2024 16:20:51 GMT-0500 (Eastern Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
